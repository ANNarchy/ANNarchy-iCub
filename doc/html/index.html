<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ANNarchy iCub Interface: iCub ANNarchy Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ANNarchy iCub Interface
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">iCub ANNarchy Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This program is an interface between the Neurosimulator ANNarchy and the iCub robot (tested with the iCub simulator and partly with gazebo). It is written in C++ with a Cython wrapping to Python.</p>
<h1>Interface Module level description</h1>
<p>Possible actions are the reading and writing of joint angles, get the current state or move the robot joints. Further, the camera images and the tactile sensors data can be received.</p>
<p>The interface consists of different parts. Clustering the different tasks of the interface:</p>
<ol type="1">
<li>ANNarchy_iCub_Populations<ul>
<li>In the ANNarchy_iCub_Populations submodule the specific input/output ANNarchy populations are defined. This can only be used with gRPC to receive/send the data from/to the iCub modules.</li>
</ul>
</li>
<li>iCub<ul>
<li>This submodule consists on the one hand of the core modules to communicate with the iCub, which are the sensor reader (Skin, Camera, Joint) and the joint writer. On the other hand a more abstract Wrapper is given, which gives the opportunity to initialize the interface module with a given XML-file. The core modules are described in more detail in the following:<ol type="a">
<li><em><a class="el" href="d1/dc0/classJointReader.html" title="Read-out of the joint angles of the iCub robot.">JointReader</a>:</em><br  />
 This module handles the joint reading. The iCub robot is divided in multiple robot parts, which are the head, right arm, left arm, torso right leg and left leg.<br  />
 Before the first usage of a joint reader instance, it has to be initialized with some specifications like the robot part. Then the joint angles can be received in two ways. As a double value or in a population code for one, multiple or all joint/s of the associated iCub part.</li>
<li><em><a class="el" href="df/d23/classJointWriter.html" title="Write the joint angles to the iCub robots joints to move them.">JointWriter</a>:</em><br  />
 The joint writer has a similar structure to the joint reader. They also has to be initialized before usage.<br  />
 For the writing of the joint angles the same ways are possible like for the reading. The joint angle can be written as double value or as population code for one, multiple or all joint/s of the associated part.</li>
<li><em><a class="el" href="d5/df3/classVisualReader.html" title="Read-out of the camera images from the iCub robot.">VisualReader</a>:</em><br  />
 This module handles the receiving of the camera images.<br  />
 This reader can be initilized for the right ('r') or left ('l') eye, limiting the visual data to be monocular. The grayscaled image is returned as an 1D-vector with a normalization from 0.0 (black) to 1.0 (white).<br  />
 In the binocular mode ('b') the images of both cameras images are received and seperately added as 1D-vectors to the image buffer.</li>
<li><em><a class="el" href="d1/dc5/classSkinReader.html" title="Read-out of the skin sensor data from the iCubs artificial skin.">SkinReader</a>:</em><br  />
 This module handles the tactile data from the iCub's artificial skin. The robot is at several parts equipped with skin modules, reacting to pressure.<br  />
 The sensor data for the arms can be read out with this module. The skin of the iCub arm is seperated in three modules, being the arm, forearm and hand.<br  />
 The tactile data is returned as a vector with doubles in a range of 0.0 to 1.0. Where 0. is no pressure and 1.0 is the maximum sensor response.</li>
</ol>
</li>
</ul>
</li>
<li>Sync<ul>
<li>The Sync module provide two classes MasterClock and ClockInterface. Thereby, the MasterClock is the main synchronization handler and for the use exactly one instance of it is needed to create. To synchronize the ANNarchy and iCub simulations, for each side one derived class of the ClockInterface ahs to be created. This class provide two abstract functions, which has to be impleemnted. The first is the update method and the second is sync_input. These method are executed once for update step. The timing can be individually be set and is dependent on the usecase.<br  />
 At this time this synchronization mechanism should only be used with the iCub in simulation.</li>
</ul>
</li>
<li>Vocabs<ul>
<li>The Vocabs module provide several useful constants like the iCub part strings or a mapping from the joint names to the joint indices in the respective part.</li>
</ul>
</li>
</ol>
<h1>Folder structure</h1>
<ul>
<li>Interface_ANNarchy_iCub -&gt; Main folder containing the whole interface<ul>
<li>Interface_ANN_iCub<ul>
<li>ANNarchy_iCub_Populations -&gt; ANNarchy population source files for the iCub input/output populations</li>
<li>grpc-&gt; gRPC communication source files</li>
<li>iCub -&gt; Contains the Cython files (pyx, pxd) for wrapping the C++ code for the use in Python (iCub interaction modules)</li>
<li>Sync -&gt; Classes used for synchronized execution of iCub interaction, ANNarchy simulation and further modules</li>
<li>include -&gt; This folder contains the C++ header files for the interface modules.<ul>
<li>INI_Reader -&gt; The INI-Reader is an external module, which is used to handle ini-files.</li>
</ul>
</li>
<li>src -&gt; This folder contains the C++ source files for the interface modules.</li>
</ul>
</li>
<li>data -&gt; Folder capsulate the data files used by the interface.<ul>
<li>sensor_positions -&gt; This folder caontains the files from the iCub simulator installation with the position data for the tactile sensors.</li>
<li>interface_param.ini -&gt; ini-file with several parameters for the interface</li>
<li>joint_limits_sim.ini -&gt; In the ini file the simulated robot joint limitations of the iCub are given.</li>
<li>joint_limits_real.ini -&gt; In the ini file the real robot joint limitations of the iCub are given.<br  />
 !!! This should be checked before the usage with the real robot, to avoid damage. !!!</li>
</ul>
</li>
<li>doc -&gt; This folder contains the doxygen generated documentation for the interface</li>
<li>Testfiles -&gt; files for interface testing</li>
</ul>
</li>
</ul>
<h1>Installation</h1>
<p>Make sure YARP is insalled before installing the interface. AN installation guide for YARP/iCub can be found in <a href="https://ai.informatik.tu-chemnitz.de/gogs/iCub_TUC/iCub_simulator_tools.git">iCub_simulator_tools</a> or direct in the github <a href="https://github.com/robotology/robotology-superbuild">superbuild repository</a> of the YARP/iCub universe.</p>
<p>Then the interface can be installed with pip by executing the following line in a terminal in the interface directory. </p><div class="fragment"><div class="line">pip install . --use-feature=in-tree-build</div>
</div><!-- fragment --><p>In case of missing/false include directories the <a class="el" href="d6/d30/make__config_8py.html">make_config.py</a> file has to be modified. The interface is build in a default configuration. In this case the gRPC communication with ANNarchy is disabled. To enable this part, set the use_grpc parameter in <a class="el" href="d6/d30/make__config_8py.html">make_config.py</a> to True. This part depends on the gRPC package and a protobuf compiler. The system packages should only be used at recent Linux versions. Recommended is the <a href="https://grpc.io/docs/languages/cpp/quickstart/#install-grpc">installation from the repository</a> with cmake/bazel.</p>
<h1>Generic Python Examples</h1>
<p>Take a look in the testfiles for a specific implementation. More examples will follow.</p>
<h2>Non gRPC version</h2>
<div class="fragment"><div class="line">from iCub_ANN_Interface.iCub import Joint_Reader, Joint_Writer, iCub_Interface, Visual_Reader, Skin_Reader</div>
<div class="line">import iCub_ANN_Interface.Vocabs as iCub_Constants</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">iCub = iCub_Interface.iCubANN_wrapper()</div>
<div class="line">...</div>
<div class="line"># add necessary instances</div>
<div class="line">jreader = Joint_Reader.PyJointReader()</div>
<div class="line">jwriter = Joint_Writer.PyJointWriter()</div>
<div class="line">sreader = Skin_Reader.PySkinReader()</div>
<div class="line">visreader = Visual_Reader.PyVisualReader()</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># init modules (necessary for all modules before usage)</div>
<div class="line">jreader.init(iCub, name , ...)</div>
<div class="line">jwriter.init(iCub, name , ...)</div>
<div class="line">sreader.init(iCub, name , ...)</div>
<div class="line">visreader.init(iCub, name, ...)</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># use interface modules</div>
<div class="line">jreader.method_name(...)</div>
<div class="line">jwriter.method_name(...)</div>
<div class="line">sreader.method_name(...)</div>
<div class="line">visreader.method_name(...)</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Close modules</div>
<div class="line">jreader.close(iCub)</div>
<div class="line">jwriter.close(iCub)</div>
<div class="line">sreader.close(iCub)</div>
<div class="line">visreader.close(iCub)</div>
<div class="line"> </div>
<div class="line">del jreader, jwriter, sreader, visreader</div>
<div class="line">del iCub</div>
</div><!-- fragment --><h2>gRPC version</h2>
<div class="fragment"><div class="line">from iCub_ANN_Interface import __root_path__ as interface_root</div>
<div class="line">from iCub_ANN_Interface.iCub import Joint_Reader, Joint_Writer, iCub_Interface, Visual_Reader, Skin_Reader</div>
<div class="line">from iCub_ANN_Interface.ANNarchy_Populations import JointReadout, JointControl, SkinPopulation, VisionPopulation</div>
<div class="line">import iCub_ANN_Interface.Vocabs as iCub_Constants</div>
<div class="line"> </div>
<div class="line"># Create ANNarchy populations e.g. VisionPopulation</div>
<div class="line">pop_vis = VisionPopulation( geometry = (240,320) )</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Create the rest of ANNarchy network</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Compile ANNarchy network</div>
<div class="line">ann_interface_root = interface_root + &quot;/&quot;</div>
<div class="line">compile(directory=&#39;results/annarchy_vreader&#39;, compiler_flags=&quot;-I&quot;+ann_interface_root+&quot; -Wl,-rpath,&quot;+ann_interface_root+&quot;/iCub_ANN_Interface/grpc/&quot;, extra_libs=&quot;-lprotobuf -lgrpc++ -lgrpc++_reflection -L&quot;+ann_interface_root+&quot;iCub_ANN_Interface/grpc/ -liCub_ANN_grpc&quot;)</div>
<div class="line"> </div>
<div class="line"># Connect ANNarchy interface populations to gRPC service</div>
<div class="line">pop_vis.connect()</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Instanciate main iCub wrapper</div>
<div class="line">iCub = iCub_Interface.iCubANN_wrapper()</div>
<div class="line"> </div>
<div class="line"># Add necessary module instances</div>
<div class="line">visreader = Visual_Reader.PyVisualReader()</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Init modules (necessary for all modules before usage)</div>
<div class="line">visreader.init_grpc(iCub, &quot;name&quot;, &#39;l&#39;, ip_address=&quot;0.0.0.0&quot;, port=pop_vis.port)</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># use interface modules</div>
<div class="line">visreader.method_name(...)</div>
<div class="line">...</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"># Close modules</div>
<div class="line">visreader.close(iCub)</div>
<div class="line"> </div>
<div class="line">del visreader</div>
<div class="line">del iCub</div>
</div><!-- fragment --><h1>useful links</h1>
<p>Wiki for the iCub robot:<br  />
 <a href="http://wiki.icub.org/wiki/Manual">http://wiki.icub.org/wiki/Manual</a></p>
<p>YARP website:<br  />
 <a href="http://www.yarp.it/index.html">http://www.yarp.it/index.html</a></p>
<p>git repository with helpful documents and scripts for the work with iCub:<br  />
 <a href="https://ai.informatik.tu-chemnitz.de/gogs/torsten/iCub_simulator_tools.git">https://ai.informatik.tu-chemnitz.de/gogs/torsten/iCub_simulator_tools.git</a></p>
<h1>Authors</h1>
<p>Torsten Fietzek (<a href="#" onclick="location.href='mai'+'lto:'+'tor'+'st'+'en.'+'fi'+'etz'+'ek'+'@in'+'fo'+'rma'+'ti'+'k.t'+'u-'+'che'+'mn'+'itz'+'.d'+'e'; return false;">torst<span style="display: none;">.nosp@m.</span>en.f<span style="display: none;">.nosp@m.</span>ietze<span style="display: none;">.nosp@m.</span>k@in<span style="display: none;">.nosp@m.</span>forma<span style="display: none;">.nosp@m.</span>tik.<span style="display: none;">.nosp@m.</span>tu-ch<span style="display: none;">.nosp@m.</span>emni<span style="display: none;">.nosp@m.</span>tz.de</a>)<br  />
 Helge Ãœlo Dinkelbach<br  />
</p>
<h1>Dependencies</h1>
<p>Python &gt;= 3.5<br  />
 YARP &gt;= 3.2<br  />
 OpenCV &gt;= 3.4<br  />
 numpy <br  />
 (Optional) <br  />
 gRPC &gt;= <br  />
 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
